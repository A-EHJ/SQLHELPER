@page "/history"
@inject SqlHelperService SqlHelperService

<PageTitle>History</PageTitle>

<h1 class="h3 mb-4">History</h1>

<div class="card shadow-sm border-0">
    <div class="card-header">Executed items</div>
    <div class="list-group list-group-flush">
        @foreach (var item in _history)
        {
            <div class="list-group-item">
                <div class="d-flex justify-content-between">
                    <div>
                        <div class="fw-semibold">@item.Title</div>
                        <div class="small text-muted">@item.ExecutedOn.LocalDateTime</div>
                        <div class="small">@item.Statement</div>
                    </div>
                    <span class="badge bg-secondary align-self-start">@item.Status</span>
                </div>
            </div>
        }
        @if (!_history.Any())
        {
            <div class="list-group-item text-muted">No activity yet.</div>
        }
    </div>
</div>

@code {
    private IReadOnlyList<QueryHistoryEntry> _history = Array.Empty<QueryHistoryEntry>();

    protected override async Task OnInitializedAsync()
    {
        _history = await SqlHelperService.GetHistoryAsync();
    }
}
